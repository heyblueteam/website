{{- /* 
================================================================================
STATS SECTION COMPONENT
================================================================================
Displays animated statistics that count up when scrolled into view.

USAGE:
{{template "stats-section" $statsData}}

EXAMPLE IMPLEMENTATION:
{{$statsData := parseJSON `{
    "Title": "Blue is mission-critical infrastructure for thousands of teams.",
    "Stats": [
        { "Number": "17K+", "Description": "Teams trust Blue" },
        { "Number": "2M+", "Description": "Records created" },
        { "Number": "99.9%", "Description": "Uptime SLA" }
    ],
    "MarginBottom": "mb-20"  // Optional
}`}}
{{template "stats-section" $statsData}}


DATA STRUCTURE:
{
    "Title": "Section title",            // Section heading (required)
    "Stats": [                          // Array of stat objects (required)
        {
            "Number": "17K+",            // Display number with suffix (required)
            "Description": "Description"  // Stat description (required)
        }
    ],
    "MarginBottom": "mb-20"             // Custom margin class (optional)
}

SUPPORTED NUMBER FORMATS:
- Plain numbers: "1000" → counts to 1,000
- With K suffix: "17K+" → counts to 17K+
- With M suffix: "2M+" → counts to 2M+
- With B suffix: "1B+" → counts to 1B+
- Percentages: "99.9%" → counts to 99.9%
- Decimals preserved for percentages

FEATURES:
- Animated count-up effect on scroll
- Smart number parsing and formatting
- Easing function for smooth animation
- Intersection observer for trigger
- Supports K/M/B suffixes
- Percentage handling with decimals
- AlpineJS-powered animation
- Dark mode support

ANIMATION DETAILS:
- Triggers when 50% visible in viewport
- Ease-out cubic easing function
- Updates on scroll while in view
- Preserves original number format
- Smooth progression from 0 to target

LAYOUT:
- Container: max-width 6xl (72rem)
- Section padding: 16 units (4rem) vertical
- Title margin: 16 units (4rem) bottom
- Grid: 1 column mobile, 3 desktop
- Gap: 8 units mobile, 12 desktop

STYLING:
- Title: 3xl font size, centered
- Numbers: 4xl-6xl font size, medium weight
- Number color: Gray-900 (dark: gray-100)
- Description: lg font size, gray-600
- Tight tracking on numbers

TECHNICAL IMPLEMENTATION:
- Uses x-intersect for viewport detection
- Progress calculated based on scroll position
- Numbers update via requestAnimationFrame
- Handles number parsing and formatting
- Maintains original suffix formatting

USE CASES:
- Company statistics
- Performance metrics
- Achievement showcases
- Growth indicators
- Trust signals
*/ -}}
{{define "stats-section"}}
<!-- Stats Section Component -->
<section class="{{if .MarginBottom}}{{.MarginBottom}}{{else}}mb-16{{end}}">
    <div class="text-center max-w-6xl mx-auto">
        <!-- Title -->
        <h2 class="text-3xl text-gray-900 dark:text-gray-100 mb-16">{{.Title}}</h2>
        
        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-12"
             x-data="{
                intersecting: false,
                progress: 0,
                stats: [
                    {{range .Stats}}
                    { 
                        originalText: '{{.Number}}', 
                        current: 0, 
                        description: '{{.Description}}',
                        target: 0,
                        suffix: ''
                    },
                    {{end}}
                ],
                init() {
                    this.stats.forEach(stat => {
                        const text = stat.originalText;
                        // Extract number and suffix (including %)
                        // Updated regex to handle numbers with commas
                        const match = text.match(/^([\d,]+(?:\.\d+)?)\s*([KMB+%]*)/i);
                        if (match) {
                            // Remove commas before parsing
                            let num = parseFloat(match[1].replace(/,/g, ''));
                            const suffix = match[2] || '';
                            
                            // Convert K, M, B to actual numbers
                            if (suffix.includes('K')) num *= 1000;
                            else if (suffix.includes('M')) num *= 1000000;
                            else if (suffix.includes('B')) num *= 1000000000;
                            
                            stat.target = num;
                            stat.suffix = suffix;
                            stat.isPercentage = suffix.includes('%');
                        } else {
                            // Fallback for plain numbers
                            stat.target = parseInt(text.replace(/,/g, '')) || 0;
                            stat.suffix = '';
                            stat.isPercentage = false;
                        }
                    });
                },
                updateProgress() {
                    this.progress = Math.max(0, Math.min((window.innerHeight - $el.getBoundingClientRect().top) / (window.innerHeight * 0.5), 1));
                    this.updateNumbers();
                },
                updateNumbers() {
                    this.stats.forEach(stat => {
                        // Easing function (ease-out)
                        const easedProgress = 1 - Math.pow(1 - this.progress, 3);
                        if (stat.isPercentage) {
                            // For percentages, preserve decimal places
                            const decimals = stat.originalText.match(/\.(\d+)/) ? stat.originalText.match(/\.(\d+)/)[1].length : 0;
                            stat.current = parseFloat((stat.target * easedProgress).toFixed(decimals));
                        } else {
                            stat.current = Math.floor(stat.target * easedProgress);
                        }
                    });
                },
                formatNumber(num, suffix) {
                    if (suffix.includes('%')) {
                        // For percentages, show the number as-is with %
                        return num + '%';
                    }
                    if (suffix.includes('K')) return Math.floor(num / 1000) + 'K+';
                    if (suffix.includes('M')) return Math.floor(num / 1000000) + 'M+';
                    if (suffix.includes('B')) return Math.floor(num / 1000000000) + 'B+';
                    return num.toLocaleString() + (suffix.includes('+') ? '+' : '');
                }
             }"
             x-init="init(); updateProgress()"
             x-intersect="intersecting = true"
             x-intersect:leave="intersecting = false"
             x-on:scroll.window="if (intersecting) { updateProgress() }">
            <template x-for="(stat, index) in stats" :key="index">
                <div class="text-center">
                    <!-- Large Number -->
                    <div class="text-4xl md:text-5xl lg:text-6xl font-medium tracking-tight text-gray-900 dark:text-gray-100 mb-4" x-text="formatNumber(stat.current, stat.suffix)"></div>
                    <!-- Description -->
                    <div class="text-lg text-gray-600 dark:text-gray-400" x-text="stat.description"></div>
                </div>
            </template>
        </div>
    </div>
</section>
{{end}}