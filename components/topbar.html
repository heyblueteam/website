{{define "topbar"}}
<!-- Scroll Indicator -->
<div class="fixed top-0 left-0 w-full h-1 z-[60]">
    <div class="h-1 bg-gradient-to-r from-blue-100 transition-all duration-300 ease-out"
         :style="'width: ' + scrollProgress + '%; background-image: linear-gradient(to right, #dbeafe, #00a0d2);'"></div>
</div>

<!-- Top Navigation Bar -->
<header class="bg-white backdrop-filter backdrop-blur-lg bg-opacity-70 fixed top-0 left-0 right-0 z-50 h-16">
    <div class="relative flex items-center justify-between px-4 h-full">
        <!-- Logo and Toggle -->
        <div class="flex items-center">
            <a href="/" class="flex items-center">
                <img src="/public/logo/logo.svg" alt="Blue" class="h-8 w-auto ml-3">
            </a>
            <button @click="sidebarsOpen = !sidebarsOpen" 
                    class="p-2 ml-4 rounded-md hover:bg-gray-100 transition-colors text-gray-500 hover:text-gray-700 cursor-pointer focus:outline-none">
                <svg class="w-4 h-6" fill="none" stroke="currentColor" viewBox="0 0 16 24">
                    <rect x="1" y="4" width="14" height="16" stroke-width="1.5" rx="1"></rect>
                    <rect :class="sidebarsOpen ? 'fill-current' : 'fill-transparent'" 
                          x="1" y="4" width="7" height="16" rx="1" 
                          class="transition-all duration-300"></rect>
                </svg>
            </button>
        </div>
        
        <!-- Center Search Bar - Absolutely positioned for true centering -->
        <div class="absolute left-1/2 transform -translate-x-1/2 w-full max-w-md px-8"
             x-data="{
                 query: '',
                 results: [],
                 fuse: null,
                 showResults: false,
                 selectedIndex: -1,
                 loading: false,
                 async init() {
                     try {
                         const response = await fetch('/public/searchIndex.json');
                         const data = await response.json();
                         this.fuse = new Fuse(data, {
                             keys: [
                                 { name: 'title', weight: 0.7 },
                                 { name: 'content', weight: 0.3 },
                                 { name: 'description', weight: 0.5 }
                             ],
                             threshold: 0.3,
                             includeScore: true,
                             includeMatches: true
                         });
                     } catch (error) {
                         console.error('Failed to load search index:', error);
                     }
                 },
                 search() {
                     if (!this.query.trim() || !this.fuse) {
                         this.results = [];
                         this.showResults = false;
                         return;
                     }
                     
                     this.loading = true;
                     this.results = this.fuse.search(this.query).slice(0, 8);
                     this.showResults = true;
                     this.selectedIndex = -1;
                     this.loading = false;
                 },
                 selectResult(result) {
                     window.location.href = result.item.url;
                 },
                 getSnippet(result) {
                     const content = result.item.content || result.item.description || '';
                     const queryWords = this.query.toLowerCase().split(' ');
                     
                     // Find first occurrence of query words
                     let bestIndex = 0;
                     for (let word of queryWords) {
                         const index = content.toLowerCase().indexOf(word);
                         if (index !== -1) {
                             bestIndex = Math.max(0, index - 40);
                             break;
                         }
                     }
                     
                     const snippet = content.substring(bestIndex, bestIndex + 120);
                     return bestIndex > 0 ? '...' + snippet + '...' : snippet + '...';
                 },
                 handleKeydown(event) {
                     if (!this.showResults) return;
                     
                     if (event.key === 'ArrowDown') {
                         event.preventDefault();
                         this.selectedIndex = Math.min(this.selectedIndex + 1, this.results.length - 1);
                     } else if (event.key === 'ArrowUp') {
                         event.preventDefault();
                         this.selectedIndex = Math.max(this.selectedIndex - 1, -1);
                     } else if (event.key === 'Enter' && this.selectedIndex >= 0) {
                         event.preventDefault();
                         this.selectResult(this.results[this.selectedIndex]);
                     } else if (event.key === 'Escape') {
                         this.showResults = false;
                         this.selectedIndex = -1;
                     }
                 }
             }"
             @click.away="showResults = false">
            <div class="relative">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <i class="fas fa-search text-gray-400 text-sm"></i>
                </div>
                <input 
                    type="text" 
                    x-model="query"
                    @input.debounce.50ms="search()"
                    @keydown="handleKeydown($event)"
                    @focus="query && search()"
                    class="block w-full pl-10 pr-16 py-2 border border-transparent bg-gray-100 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:bg-white focus:border-gray-300 transition-all duration-200"
                    placeholder="Search anything..."
                    autocomplete="off"
                    id="searchInput"
                >
                
                <!-- Keyboard shortcut indicator -->
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none space-x-1"
                     x-data="{ isMac: navigator.userAgent.indexOf('Mac') !== -1 }">
                    <span x-show="isMac" class="inline-flex items-center justify-center w-5 h-5 bg-gray-200 rounded text-xs font-bold text-gray-400 border border-gray-300">⌘</span>
                    <span x-show="!isMac" class="inline-flex items-center justify-center w-7 h-5 bg-gray-200 rounded text-xs font-bold text-gray-400 border border-gray-300">Ctrl</span>
                    <span class="inline-flex items-center justify-center w-5 h-5 bg-gray-200 rounded text-xs font-bold text-gray-400 border border-gray-300">K</span>
                </div>
                
                <!-- Search Results Dropdown -->
                <div x-show="showResults" 
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 translate-y-1"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 translate-y-0"
                     x-transition:leave-end="opacity-0 translate-y-1"
                     class="absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 max-h-96 overflow-y-auto z-50 custom-scrollbar">
                    
                    <template x-if="loading">
                        <div class="p-4 text-center text-gray-500 text-sm">
                            <i class="fas fa-spinner fa-spin mr-2"></i>Searching...
                        </div>
                    </template>
                    
                    <template x-if="!loading && results.length === 0 && query">
                        <div class="p-4 text-center text-gray-500 text-sm">
                            No results found for "<span x-text="query"></span>"
                        </div>
                    </template>
                    
                    <template x-if="!loading && results.length > 0">
                        <div class="py-2">
                            <template x-for="(result, index) in results" :key="index">
                                <div @click="selectResult(result)"
                                     :class="selectedIndex === index ? 'bg-blue-50' : 'hover:bg-gray-50'"
                                     class="px-4 py-3 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors">
                                    <div class="flex items-start">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-gray-900 text-sm" x-text="result.item.title"></h4>
                                            <p class="text-sm text-gray-600 mt-1 line-clamp-2" x-text="getSnippet(result)"></p>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </div>
        
        <!-- Right side controls -->
        <div class="flex items-center space-x-4">
            <!-- Light/Dark mode toggle -->
            <button class="p-2 text-gray-500 hover:text-gray-700 focus:outline-none">
                <i class="fas fa-moon text-lg"></i>
            </button>
            
            <!-- Login -->
            <a href="https://app.blue.cc" target="_blank" class="px-4 py-2 text-sm font-semibold rounded-md border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:outline-none transition duration-150 ease-in-out flex items-center">
                Log In
                <span class="ml-2 inline-flex items-center justify-center w-5 h-5 bg-gray-200 rounded text-xs font-bold text-gray-700 border border-gray-300">L</span>
            </a>
            
            <!-- Contact -->
            <a href="/contact" class="px-4 py-2 text-sm font-semibold rounded-md border-2 border-brand-blue bg-blue-50 text-gray-900 hover:bg-blue-100 focus:outline-none transition duration-150 ease-in-out flex items-center cursor-pointer">
                Contact
                <span class="ml-2 inline-flex items-center justify-center w-5 h-5 bg-gray-200 rounded text-xs font-bold text-gray-700 border border-gray-300">C</span>
            </a>
            
            <!-- Sign Up -->
            <a href="https://app.blue.cc" target="_blank" class="px-4 py-2 text-sm font-semibold rounded-md border border-transparent bg-brand-blue text-white hover:bg-brand-blue-hover focus:outline-none transition duration-150 ease-in-out flex items-center">
                Sign Up
                <span class="ml-2 inline-flex items-center justify-center w-5 h-5 bg-white rounded text-xs font-bold" style="color: #00a0d2; border-color: #00a0d2;">↵</span>
            </a>
        </div>
    </div>
    
    <!-- Keyboard shortcuts script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            function openLogin() {
                window.open('https://app.blue.cc', '_blank');
            }

            function openSignUp() {
                window.open('https://app.blue.cc', '_blank');
            }

            function handleKeyPress(event) {
                // Check if the active element is an input, textarea, or any element within a form
                const activeElement = document.activeElement;
                const isFormElement = activeElement.tagName === 'INPUT' ||
                                    activeElement.tagName === 'TEXTAREA' ||
                                    activeElement.tagName === 'SELECT' ||
                                    activeElement.isContentEditable ||
                                    activeElement.closest('form') !== null;

                // Handle Cmd+K / Ctrl+K for search (works globally)
                if ((event.metaKey || event.ctrlKey) && event.key.toLowerCase() === 'k') {
                    event.preventDefault();
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        searchInput.focus();
                    }
                    return;
                }

                // Only proceed with other shortcuts if not interacting with a form element
                // and no modifier keys are pressed
                if (!isFormElement && !event.metaKey && !event.ctrlKey && !event.altKey && !event.shiftKey) {
                    if (event.key.toLowerCase() === 'l') {
                        event.preventDefault();
                        openLogin();
                    } else if (event.key.toLowerCase() === 'c') {
                        event.preventDefault();
                        window.location.href = '/contact';
                    } else if (event.key === 'Enter') {
                        event.preventDefault();
                        openSignUp();
                    }
                }
            }

            document.addEventListener('keydown', handleKeyPress);
        });
    </script>
</header>
{{end}}