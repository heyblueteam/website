---
title: វាលផ្ទាល់ខ្លួនសមីការណ៍
description: បង្កើតវាលគណនាដែលគណនាតម្លៃដោយស្វ័យប្រវត្តិផ្អែកលើទិន្នន័យផ្សេងទៀត
---

វាលផ្ទាល់ខ្លួនសមីការណ៍ត្រូវបានប្រើសម្រាប់ការគណនាក្រាហ្វិក និងផ្ទាំងគ្រប់គ្រងនៅក្នុង Blue។ វាបញ្ជាក់អំពីមុខងារបូក (SUM, AVERAGE, COUNT, ល។) ដែលប្រតិបត្តិការលើទិន្នន័យវាលផ្ទាល់ខ្លួនដើម្បីបង្ហាញមាតិកាគណនាផ្ទាំងក្រាហ្វិក។ សមីការមិនត្រូវបានគណនានៅកម្រិតtodo ប៉ុន្តែបូកទិន្នន័យនៅជុំវិញកំណត់ត្រាច្រើនសម្រាប់គោលបំណងបង្ហាញ។

## ឧទាហរណ៍មូលដ្ឋាន

បង្កើតវាលសមីការសម្រាប់ការគណនាក្រាហ្វិក:

```graphql
mutation CreateFormulaField {
  createCustomField(input: {
    name: "Budget Total"
    type: FORMULA
    projectId: "proj_123"
    formula: {
      logic: {
        text: "SUM(Budget)"
        html: "<span>SUM(Budget)</span>"
      }
      display: {
        type: NUMBER
        precision: 2
        function: SUM
      }
    }
  }) {
    id
    name
    type
    formula
  }
}
```

## ឧទាហរណ៍កម្រិតខ្ពស់

បង្កើតសមីការប្រាក់ជាមួយការគណនាដែលស្មុគស្មាញ:

```graphql
mutation CreateCurrencyFormula {
  createCustomField(input: {
    name: "Profit Margin"
    type: FORMULA
    projectId: "proj_123"
    formula: {
      logic: {
        text: "SUM(Revenue) - SUM(Costs)"
        html: "<span>SUM(Revenue) - SUM(Costs)</span>"
      }
      display: {
        type: CURRENCY
        currency: {
          code: "USD"
          name: "US Dollar"
        }
        precision: 2
      }
    }
    description: "Automatically calculates profit by subtracting costs from revenue"
  }) {
    id
    name
    type
    formula
  }
}
```

## ប៉ារ៉ាម៉ែត្រ​ចូល

### CreateCustomFieldInput

| ប៉ារ៉ាម៉ែត្រ | ប្រភេទ | ត្រូវការ | ការពិពណ៌នា |
|-----------|------|----------|-------------|
| `name` | String! | ✅ បាទ | ឈ្មោះបង្ហាញនៃវាលសមីការណ៍ |
| `type` | CustomFieldType! | ✅ បាទ | ត្រូវតែជា `FORMULA` |
| `projectId` | String! | ✅ បាទ | អត្តសញ្ញាណគម្រោងដែលវាលនេះនឹងត្រូវបានបង្កើត |
| `formula` | JSON | មិនត្រូវការ | ការកំណត់សមីការសម្រាប់ការគណនាក្រាហ្វិក |
| `description` | String | មិនត្រូវការ | អត្ថបទជំនួយដែលបង្ហាញទៅអ្នកប្រើ |

### រចនាសម្ព័ន្ធសមីការណ៍

```json
{
  "logic": {
    "text": "Display text for the formula",
    "html": "HTML formatted display text"
  },
  "display": {
    "type": "NUMBER|CURRENCY|PERCENTAGE",
    "currency": {
      "code": "USD",
      "name": "US Dollar"  
    },
    "precision": 2,
    "function": "SUM|AVERAGE|AVERAGEA|COUNT|COUNTA|MAX|MIN"
  }
}
```

## មុខងារដែលគាំទ្រ

### មុខងារបូកក្រាហ្វិក

វាលសមីការគាំទ្រមុខងារបូកដូចខាងក្រោមសម្រាប់ការគណនាក្រាហ្វិក:

| មុខងារ | ការពិពណ៌នា | ChartFunction Enum |
|----------|-------------|-------------------|
| `SUM` | បូកតម្លៃទាំងអស់ | `SUM` |
| `AVERAGE` | មធ្យមនៃតម្លៃលេខ | `AVERAGE` |
| `AVERAGEA` | មធ្យមលើកលែងពីសូន្យ និងទិន្នន័យទទេ | `AVERAGEA` |
| `COUNT` | ចំនួនតម្លៃ | `COUNT` |
| `COUNTA` | ចំនួនលើកលែងពីសូន្យ និងទិន្នន័យទទេ | `COUNTA` |
| `MAX` | តម្លៃអតិបរិមា | `MAX` |
| `MIN` | តម្លៃអប្បបរមា | `MIN` |

**កំណត់ចំណាំ**: មុខងារទាំងនេះត្រូវបានប្រើនៅក្នុងវាល `display.function` និងប្រតិបត្តិការលើទិន្នន័យដែលបានបូកសម្រាប់ការបង្ហាញក្រាហ្វិក។ សមីការស្មុគស្មាញឬការគណនាកម្រិតវាលមិនត្រូវបានគាំទ្រ។

## ប្រភេទបង្ហាញ

### បង្ហាញលេខ

```json
{
  "display": {
    "type": "NUMBER",
    "precision": 2
  }
}
```

លទ្ធផល: `1250.75`

### បង្ហាញប្រាក់

```json
{
  "display": {
    "type": "CURRENCY",
    "currency": {
      "code": "USD",
      "name": "US Dollar"
    },
    "precision": 2
  }
}
```

លទ្ធផល: `$1,250.75`

### បង្ហាញភាគរយ

```json
{
  "display": {
    "type": "PERCENTAGE",
    "precision": 1
  }
}
```

លទ្ធផល: `87.5%`

## កែប្រាវាលសមីការណ៍

អាប់ដេតវាលសមីការដែលមានស្រាប់:

```graphql
mutation EditFormulaField {
  editCustomField(input: {
    customFieldId: "field_456"
    formula: {
      logic: {
        text: "AVERAGE(Score)"
        html: "<span>AVERAGE(Score)</span>"
      }
      display: {
        type: PERCENTAGE
        precision: 1
      }
    }
  }) {
    id
    formula
  }
}
```

## ការប្រតិបត្តិសមីការណ៍

### បរិបទគណនាក្រាហ្វិក

វាលសមីការត្រូវបានដំណើរការនៅក្នុងបរិបទនៃផ្នែកក្រាហ្វិក និងផ្ទាំងគ្រប់គ្រង:
- ការគណនាត្រូវបានធ្វើនៅពេលដែលក្រាហ្វិកត្រូវបានបង្ហាញឬអាប់ដេត
- លទ្ធផលត្រូវបានរក្សាទុកនៅក្នុង `ChartSegment.formulaResult` ជាតម្លៃទសភាគ
- ការប្រតិបត្តិគឺត្រូវបានគ្រប់គ្រងតាមរយៈកូដ BullMQ ដែលមានឈ្មោះ 'formula'
- ការអាប់ដេតផ្សាយទៅអ្នកជាវផ្ទាំងគ្រប់គ្រងសម្រាប់ការអាប់ដេតក្នុងពេលវេលាពិត

### រចនាប័ទ្មបង្ហាញ

មុខងារ `getFormulaDisplayValue` រចនាប័ទ្មលទ្ធផលដែលគណនាដោយផ្អែកលើប្រភេទបង្ហាញ:
- **លេខ**: បង្ហាញជាលេខធម្មតា ជាមួយកម្រិតភាពត្រឹមត្រូវជាជម្រើស
- **ភាគរយ**: បន្ថែម % នៅខាងក្រោយ ជាមួយកម្រិតភាពត្រឹមត្រូវជាជម្រើស  
- **ប្រាក់**: រចនាប័ទ្មដោយប្រើកូដប្រាក់ដែលបានកំណត់

## ការរក្សាទុកលទ្ធផលសមីការណ៍

លទ្ធផលត្រូវបានរក្សាទុកនៅក្នុងវាល `formulaResult`:

```json
{
  "number": 1250.75,
  "formulaResult": {
    "number": 1250.75,
    "display": {
      "type": "CURRENCY",
      "currency": {
        "code": "USD",
        "name": "US Dollar"
      },
      "precision": 2
    }
  }
}
```

## វាលឆ្លើយតប

### ឆ្លើយតប TodoCustomField

| វាល | ប្រភេទ | ការពិពណ៌នា |
|-------|------|-------------|
| `id` | String! | អត្តសញ្ញាណឯកតាដែលមានសម្រាប់តម្លៃវាល |
| `customField` | CustomField! | ការកំណត់វាលសមីការណ៍ |
| `number` | Float | លទ្ធផលលេខដែលគណនា |
| `formulaResult` | JSON | លទ្ធផលពេញលេញជាមួយការរចនាប័ទ្មបង្ហាញ |
| `todo` | Todo! | កំណត់ត្រានេះមានតម្លៃ |
| `createdAt` | DateTime! | ពេលវេលាដែលតម្លៃត្រូវបានបង្កើត |
| `updatedAt` | DateTime! | ពេលវេលាដែលតម្លៃត្រូវបានគណនាថ្មីបន្ទាប់ពី |

## បរិបទទិន្នន័យ

### ប្រភពទិន្នន័យក្រាហ្វិក

វាលសមីការប្រតិបត្តិនៅក្នុងបរិបទប្រភពទិន្នន័យក្រាហ្វិក:
- សមីការបូកតម្លៃវាលផ្ទាល់ខ្លួននៅក្នុងtodos នៅក្នុងគម្រោង
- មុខងារបូកដែលបានកំណត់នៅក្នុង `display.function` កំណត់ការគណនា
- លទ្ធផលត្រូវបានគណនាដោយប្រើមុខងារបូក SQL (avg, sum, count, ល។)
- ការគណនាត្រូវបានអនុវត្តនៅកម្រិតមូលដ្ឋានទិន្នន័យសម្រាប់ប្រសិទ្ធភាព

## ឧទាហរណ៍សមីការទូទៅ

### ប្រាក់ចំណាយសរុប (បង្ហាញក្រាហ្វិក)

```json
{
  "logic": {
    "text": "Total Budget",
    "html": "<span>Total Budget</span>"
  },
  "display": {
    "type": "CURRENCY",
    "currency": { "code": "USD", "name": "US Dollar" },
    "precision": 2,
    "function": "SUM"
  }
}
```

### ពិន្ទុមធ្យម (បង្ហាញក្រាហ្វិក)

```json
{
  "logic": {
    "text": "Average Quality Score",
    "html": "<span>Average Quality Score</span>"
  },
  "display": {
    "type": "NUMBER",
    "precision": 1,
    "function": "AVERAGE"
  }
}
```

### ចំនួនភារកិច្ច (បង្ហាញក្រាហ្វិក)

```json
{
  "logic": {
    "text": "Total Tasks",
    "html": "<span>Total Tasks</span>"
  },
  "display": {
    "type": "NUMBER",
    "precision": 0,
    "function": "COUNT"
  }
}
```

## អាជ្ញាប័ណ្ណដែលត្រូវការ

ការប្រតិបត្តិវាលផ្ទាល់ខ្លួនអនុវត្តតាមអាជ្ញាប័ណ្ណផ្អែកលើតួនាទីស្តង់ដារ:

| សកម្មភាព | តួនាទីដែលត្រូវការ |
|--------|---------------|
| Create formula field | Project member with appropriate role |
| Update formula field | Project member with appropriate role |
| View formula results | Project member with view permissions |
| Delete formula field | Project member with appropriate role |

**កំណត់ចំណាំ**: តួនាទីជាក់លាក់ដែលត្រូវការពឹងផ្អែកលើការកំណត់តួនាទីផ្ទាល់ខ្លួនរបស់គម្រោងរបស់អ្នក។ មិនមានកូដអាជ្ញាប័ណ្ណពិសេសដូចជា CUSTOM_FIELDS_CREATE ទេ។

## ការគ្រប់គ្រងកំហុស

### កំហុសផ្ទៀងផ្ទាត់
```json
{
  "errors": [{
    "message": "Validation error message",
    "extensions": {
      "code": "VALIDATION_ERROR"
    }
  }]
}
```

### វាលផ្ទាល់ខ្លួនមិនបានរកឃើញ
```json
{
  "errors": [{
    "message": "Custom field was not found.",
    "extensions": {
      "code": "CUSTOM_FIELD_NOT_FOUND"
    }
  }]
}
```

## អនុសាសន៍ល្អ

### រចនាសមីការណ៍
- ប្រើឈ្មោះដែលច្បាស់និងពិពណ៌នាសម្រាប់វាលសមីការណ៍
- បន្ថែមការពិពណ៌នាដែលពន្យល់អំពីយុត្តិធម៌គណនា
- សាកល្បងសមីការជាមួយទិន្នន័យគំរូមុនពេលបញ្ចូលប្រើប្រាស់
- រក្សាសមីការឲ្យមានភាពសាមញ្ញ និងអាចអានបាន

### ការបង្កើនប្រសិទ្ធភាព
- ជៀសវាងការពឹងផ្អែកលើសមីការដែលមានកម្រិតជ្រាលជ្រៅ
- ប្រើការយោងវាលជាក់លាក់ជាងការប្រើ wildcard
- សូមពិចារណាអំពីយុទ្ធសាស្ត្រក caching សម្រាប់ការគណនាស្មុគស្មាញ
- តាមដានប្រសិទ្ធភាពសមីការនៅក្នុងគម្រោងធំ

### គុណភាពទិន្នន័យ
- ផ្ទៀងផ្ទាត់ទិន្នន័យប្រភពមុនពេលប្រើនៅក្នុងសមីការណ៍
- គ្រប់គ្រងតម្លៃទទេឬទិន្នន័យទទេយ៉ាងត្រឹមត្រូវ
- ប្រើភាពត្រឹមត្រូវដែលសមស្របសម្រាប់ប្រភេទបង្ហាញ
- សូមពិចារណាអំពីករណីកំណត់នៅក្នុងការគណនា

## ករណីប្រើប្រាស់ទូទៅ

1. **ការតាមដានហិរញ្ញវត្ថុ**
   - ការគណនាប្រាក់ចំណាយ
   - សេចក្តីថ្លែងការណ៍ប្រាក់ចំណេញ/ខាត
   - ការវិភាគថ្លៃដើម
   - ការព្យាករណ៍ប្រាក់ចំណូល

2. **ការគ្រប់គ្រងគម្រោង**
   - ភាគរយការបញ្ចប់
   - ការប្រើប្រាស់ធនធាន
   - ការគណនាពេលវេលា
   - មាតិកាប្រសិទ្ធភាព

3. **ការត្រួតពិនិត្យគុណភាព**
   - ពិន្ទុមធ្យម
   - អត្រាប្រកួត/បរាជ័យ
   - មាតិកាគុណភាព
   - ការតាមដានការអនុវត្ត

4. **ការបញ្ចេញព័ត៌មានអាជីវកម្ម**
   - ការគណនាអត្រា KPI
   - ការវិភាគនិន្នាការ
   - មាតិកាប្រៀបធៀប
   - តម្លៃផ្ទាំងគ្រប់គ្រង

## ការកំណត់

- សមីការត្រូវបានគេប្រើសម្រាប់ការបូកក្រាហ្វិក/ផ្ទាំងគ្រប់គ្រងតែប៉ុណ្ណោះ មិនមែនសម្រាប់ការគណនាកម្រិតtodoទេ
- មានកំណត់ទៅលើមុខងារបូកប្រាំពីរ (SUM, AVERAGE, ល។)
- មិនមានសមីការស្មុគស្មាញឬការគណនារវាលទៅវាលទេ
- មិនអាចយោងទៅកាន់វាលច្រើននៅក្នុងសមីការមួយបានទេ
- លទ្ធផលត្រូវបានមើលឃើញតែក្នុងក្រាហ្វិក និងផ្ទាំងគ្រប់គ្រង
- វាល `logic` គឺសម្រាប់អត្ថបទបង្ហាញតែប៉ុណ្ណោះ មិនមែនយុត្តិធម៌គណនាអ្វីទេ

## ឯកសារដែលពាក់ព័ន្ធ

- [វាលលេខ](/api/5.custom%20fields/number) - សម្រាប់តម្លៃលេខស្ថិតិ
- [វាលប្រាក់](/api/5.custom%20fields/currency) - សម្រាប់តម្លៃហិរញ្ញវត្ថុ
- [វាលយោង](/api/5.custom%20fields/reference) - សម្រាប់ទិន្នន័យឆ្លងគម្រោង
- [វាលស្វែងរក](/api/5.custom%20fields/lookup) - សម្រាប់ទិន្នន័យដែលបានបូក
- [ទិដ្ឋភាពទូទៅនៃវាលផ្ទាល់ខ្លួន](/api/5.custom%20fields/2.list-custom-fields) - គំនិតទូទៅ